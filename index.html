<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- Responsive meta tag -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Lawsuit Buddy | Your Personal Legal Referral Assistant</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" 
        integrity="sha512-p+1Ph+bY6Rf1J7hB9ccJ+6O2rN/B7XcxMTf8w5M2h0dH0FnZ3av+HrdE+2o7HuItBOZQ9zZlJ0YcHWL2aZ0DgQ==" 
        crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- SEO Meta Tags -->
  <meta name="description" content="Lawsuit Buddy connects you with experienced legal professionals. Get help with personal injury, medical malpractice, employment law, and more.">
  <meta name="keywords" content="legal referral, personal injury lawyer, medical malpractice, employment law, legal help">
  <meta name="robots" content="index, follow">
  <meta name="author" content="Lawsuit Buddy">
  <meta name="theme-color" content="#121212">
  <link rel="canonical" href="https://lawsuitbuddy.com/">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://lawsuitbuddy.com/">
  <meta property="og:title" content="Lawsuit Buddy | Your Personal Legal Referral Assistant">
  <meta property="og:description" content="Connect with experienced legal professionals for your case.">
  <meta property="og:image" content="https://lawsuitbuddy.com/og-image.jpg">
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://lawsuitbuddy.com/">
  <meta property="twitter:title" content="Lawsuit Buddy | Your Personal Legal Referral Assistant">
  <meta property="twitter:description" content="Connect with experienced legal professionals for your case.">
  <meta property="twitter:image" content="https://lawsuitbuddy.com/og-image.jpg">

  <!-- Event Structured Data for Martiez Refinery in California -->
  <script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Event",
    "name": "Martiez Refinery Annual Conference",
    "startDate": "2023-11-25T18:30:00-08:00",
    "endDate": "2023-11-26T21:00:00-08:00",
    "location": {
      "@type": "Place",
      "name": "Martiez Refinery",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "123 Refinery Rd",
        "addressLocality": "Some City",
        "addressRegion": "CA",
        "postalCode": "90001",
        "addressCountry": "US"
      }
    },
    "image": [
      "https://lawsuitbuddy.com/images/martiez-event.jpg"
    ],
    "description": "Join the Martiez Refinery Annual Conference to learn about the latest in refining innovations and environmental safety practices.",
    "offers": {
      "@type": "Offer",
      "url": "https://lawsuitbuddy.com/event-registration",
      "price": "0",
      "priceCurrency": "USD",
      "availability": "http://schema.org/InStock",
      "validFrom": "2023-09-01T12:00:00-08:00"
    },
    "performer": {
      "@type": "PerformingGroup",
      "name": "Expert Panel of Refining Engineers"
    }
  }
  </script>
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  
  <!-- Cache Control -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  
  <!-- Security Headers -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:;">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta http-equiv="X-XSS-Protection" content="1; mode=block">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <meta http-equiv="Permissions-Policy" content="interest-cohort=()">
  <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin">
  <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp">
  
  <!-- Preload Critical Resources -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <link rel="preload" as="image" href="/images/hero-bg.webp" media="(min-width: 768px)">
  <link rel="preload" as="image" href="/images/hero-bg-mobile.webp" media="(max-width: 767px)">
  
  <style>
    /* ============================================================
       Global & Theme Settings
    ============================================================ */
    :root {
      --primary-bg: #121212;
      --secondary-bg: #1e1e1e;
      --gradient-header: linear-gradient(135deg, #1f1c2c, #928dab);
      --accent-color: #c0392b;
      --text-color: #e0e0e0;
      --light-bg: #222222;
      --container-bg: #1e1e1e;
      --transition-speed: 0.3s;
    }
    body {
      font-family: 'Roboto', sans-serif;
      background-color: var(--primary-bg);
      color: var(--text-color);
      margin: 0;
      padding: 0;
      line-height: 1.6;
      overflow-x: hidden;
    }
    a {
      text-decoration: none;
      color: var(--accent-color);
    }
    h1, h2, h3 {
      margin: 0 0 1rem 0;
    }
    .container {
      width: 90%;
      max-width: 1200px;
      margin: auto;
      padding: 0 1rem;
    }
    
    /* ============================================================
       Navigation Section
    ============================================================ */
    nav {
      background: var(--gradient-header);
      border-bottom: 1px solid #333;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    nav .container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 0;
    }
    nav .logo {
      font-size: 1.8rem;
      font-weight: 500;
      color: var(--text-color);
      letter-spacing: 1px;
    }
    nav ul {
      list-style: none;
      display: flex;
      gap: 1.5rem;
      margin: 0;
      padding: 0;
    }
    nav ul li a {
      color: var(--text-color);
      font-weight: 500;
      transition: color var(--transition-speed) ease;
    }
    nav ul li a:hover {
      color: var(--accent-color);
    }
    
    /* ============================================================
       Hero Section
    ============================================================ */
    .hero {
      background: var(--gradient-header);
      min-height: 600px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-color);
    }
    .hero::before {
      content: "";
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.7);
      animation: fadeIn 2s ease-in-out forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .hero-content {
      position: relative;
      text-align: center;
      z-index: 1;
      padding: 0 1rem;
    }
    .hero-content h1 {
      font-size: 3rem;
      margin-bottom: 1rem;
      letter-spacing: 1px;
    }
    .hero-content p {
      font-size: 1.3rem;
      margin-bottom: 2rem;
    }
    .cta-btn {
      background-color: var(--accent-color);
      color: #fff;
      padding: 0.8rem 2rem;
      border-radius: 4px;
      font-size: 1rem;
      transition: background-color var(--transition-speed) ease, transform var(--transition-speed) ease;
    }
    .cta-btn:hover {
      background-color: darkred;
      transform: scale(1.05);
    }
    
    /* ============================================================
       Static Sections (About, How It Works, Our Expertise, Disclaimer, Contact, Footer)
    ============================================================ */
    .section {
      padding: 4rem 0;
      background-color: var(--container-bg);
      border-top: 1px solid #333;
    }
    .section:nth-of-type(even) {
      background-color: var(--primary-bg);
    }
    .section h2 {
      text-align: center;
      margin-bottom: 2rem;
      color: var(--accent-color);
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    /* Updated About Section Copy */
    #about p {
      text-align: center;
      max-width: 800px;
      margin: auto;
      font-size: 1.1rem;
      line-height: 1.5;
    }
    .disclaimer {
      background-color: var(--secondary-bg);
      padding: 2rem 1rem;
      text-align: center;
      font-size: 0.9rem;
      color: #aaa;
      border-top: 1px solid #333;
    }
    .disclaimer p {
      max-width: 800px;
      margin: auto;
      line-height: 1.5;
    }
    #contact p a {
      color: var(--accent-color);
    }
    footer {
      background-color: var(--secondary-bg);
      color: var(--text-color);
      text-align: center;
      padding: 1.5rem 0;
      border-top: 1px solid #333;
    }
    footer p {
      margin: 0.5rem 0;
    }
    
    /* ============================================================
       Conversational Chat Interface
    ============================================================ */
    #chatContainer {
      background-color: var(--container-bg);
      border: 1px solid #333;
      border-radius: 8px;
      padding: 1rem;
      max-width: 600px;
      margin: 2rem auto;
      height: 400px;
      overflow-y: auto;
      transition: opacity 1s ease;
    }
    .chat-bubble {
      margin: 1rem 0;
      padding: 0.8rem 1rem;
      border-radius: 16px;
      max-width: 80%;
    }
    .chat-bot {
      background-color: var(--light-bg);
      align-self: flex-start;
    }
    .chat-user {
      background-color: var(--accent-color);
      color: #fff;
      align-self: flex-end;
    }
    #chatInputContainer {
      max-width: 600px;
      margin: 1rem auto;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    #chatInput {
      padding: 0.8rem;
      border: 1px solid #555;
      border-radius: 4px;
      background-color: #2a2a2a;
      color: var(--text-color);
      font-size: 1rem;
      display: none;
    }
    /* Quick Options for Dropdown Answers */
    #quickOptions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .quick-option {
      padding: 0.6rem 1rem;
      background-color: var(--accent-color);
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color var(--transition-speed) ease;
      font-size: 0.9rem;
    }
    .quick-option:hover {
      background-color: darkred;
    }
    #chatSendBtn {
      padding: 0.8rem 1.5rem;
      background-color: var(--accent-color);
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color var(--transition-speed) ease, transform var(--transition-speed) ease;
    }
    #chatSendBtn:hover {
      background-color: darkred;
      transform: scale(1.03);
    }
    
    /* ============================================================
       Responsive Adjustments
    ============================================================ */
    @media (max-width: 768px) {
      nav .container {
        flex-direction: column;
        gap: 1rem;
      }
      #chatContainer, #chatInputContainer {
        max-width: 90%;
      }
    }

    /* Steps Section Styling */
    .steps {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      padding: 1rem;
    }
    
    .step {
      text-align: center;
      padding: 2rem;
      background: var(--secondary-bg);
      border-radius: 8px;
      transition: transform var(--transition-speed) ease;
    }
    
    .step:hover {
      transform: translateY(-5px);
    }
    
    .step i {
      font-size: 2.5rem;
      color: var(--accent-color);
      margin-bottom: 1rem;
    }
    
    .step h3 {
      color: var(--text-color);
      margin-bottom: 1rem;
    }
    
    .step p {
      color: #aaa;
      font-size: 0.9rem;
    }

    /* Chat Improvements */
    .typing-indicator {
      display: flex;
      gap: 0.3rem;
      padding: 0.5rem 1rem;
      background: var(--light-bg);
      border-radius: 16px;
      width: fit-content;
      margin: 1rem 0;
    }
    
    .typing-dot {
      width: 8px;
      height: 8px;
      background: var(--accent-color);
      border-radius: 50%;
      animation: typingAnimation 1.4s infinite;
    }
    
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }
    
    @keyframes typingAnimation {
      0%, 100% { opacity: 0.4; transform: translateY(0); }
      50% { opacity: 1; transform: translateY(-4px); }
    }
    
    .chat-error {
      color: #ff6b6b;
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }
    
    .chat-progress {
      position: fixed;
      top: 0;
      left: 0;
      height: 3px;
      background: var(--accent-color);
      transition: width 0.3s ease;
    }
    
    .edit-previous {
      color: var(--accent-color);
      font-size: 0.8rem;
      text-decoration: underline;
      cursor: pointer;
      margin-top: 0.5rem;
    }
    
    .chat-controls {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    /* Cookie Banner */
    #cookie-banner {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--secondary-bg);
      padding: 1rem;
      text-align: center;
      z-index: 1000;
      display: none;
    }
    #cookie-accept {
      background: var(--accent-color);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      margin-left: 1rem;
      cursor: pointer;
    }

    /* Enhanced Accessibility Styles */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      border: 0;
    }
    
    /* Focus Styles */
    a:focus-visible,
    button:focus-visible {
      outline: 3px solid var(--accent-color);
      outline-offset: 2px;
    }
    
    /* Form Validation Styles */
    .error-message {
      color: #ff6b6b;
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }
    
    input:invalid,
    textarea:invalid {
      border-color: #ff6b6b;
    }
  </style>
</head>
<body>
  <!-- ============================================================
       Navigation Section
  ============================================================ -->
  <nav aria-label="Main navigation">
    <div class="container">
      <div class="logo">Lawsuit Buddy</div>
      <ul class="nav-links">
        <li><a href="#hero">Home</a></li>
        <li><a href="#about">About</a></li>
        <li><a href="#how-it-works">How It Works</a></li>
        <li><a href="#expertise">Our Expertise</a></li>
        <li><a href="#chatSection">Let's Chat</a></li>
        <li><a href="#contact">Contact</a></li>
        <li><a href="/news.html">News</a></li>
        <li><a href="/terms.html">Terms</a></li>
        <li><a href="/privacy.html">Privacy</a></li>
      </ul>
    </div>
  </nav>
  
  <!-- ============================================================
       Hero Section
  ============================================================ -->
  <header id="hero" class="hero">
    <div class="hero-content container">
      <h1>Your Trusted Legal Referral Partner</h1>
      <p>We’re here to help you share your story and get connected with the right legal support.</p>
      <a href="#chatSection" class="cta-btn"><i class="fa-solid fa-phone fa-lg"></i> Let's Chat</a>
    </div>
  </header>
  
  <!-- ============================================================
       About Section (Revised Copy)
  ============================================================ -->
  <section id="about" class="section">
    <div class="container">
      <h2>About Lawsuit Buddy</h2>
      <p>
        At Lawsuit Buddy, we believe that getting the right legal help should feel personal and stress-free. Our friendly, conversational approach allows you to share your story quickly, and we then connect you with legal professionals who truly care. Your journey toward the support you need starts here.
      </p>
    </div>
  </section>
  
  <!-- ============================================================
       How It Works Section
  ============================================================ -->
  <section id="how-it-works" class="section">
    <div class="container">
      <h2>How It Works</h2>
      <div class="steps">
        <div class="step">
          <i class="fa-solid fa-edit"></i>
          <h3>Answer a Few Questions</h3>
          <p>We’ll chat with you to understand your situation in a friendly, easy way.</p>
        </div>
        <div class="step">
          <i class="fa-solid fa-lock"></i>
          <h3>Secure Matching</h3>
          <p>Your responses are kept confidential and help us match you with the right legal expert.</p>
        </div>
        <div class="step">
          <i class="fa-solid fa-phone"></i>
          <h3>Get Contacted</h3>
          <p>A Lawsuit Buddy representative will reach out to you with personalized referral details.</p>
        </div>
      </div>
    </div>
  </section>
  
  <!-- ============================================================
       Our Expertise Section
  ============================================================ -->
  <section id="expertise" class="section">
    <div class="container">
      <h2>Our Expertise</h2>
      <div class="expertise">
        <div class="expertise-item">
          <i class="fa-solid fa-user-injured"></i>
          <h3>Personal Injury</h3>
        </div>
        <div class="expertise-item">
          <i class="fa-solid fa-box-open"></i>
          <h3>Product Liability</h3>
        </div>
        <div class="expertise-item">
          <i class="fa-solid fa-stethoscope"></i>
          <h3>Medical Malpractice</h3>
        </div>
        <div class="expertise-item">
          <i class="fa-solid fa-briefcase"></i>
          <h3>Employment Law</h3>
        </div>
        <div class="expertise-item">
          <i class="fa-solid fa-car-crash"></i>
          <h3>Accident Claims</h3>
        </div>
        <div class="expertise-item">
          <i class="fa-solid fa-file-contract"></i>
          <h3>Contract Disputes</h3>
        </div>
      </div>
    </div>
  </section>
  
  <!-- ============================================================
       Conversational Chat Interface for Legal Intake
  ============================================================ -->
  <section id="chatSection" class="section">
    <div class="container">
      <h2>Let's Chat</h2>
      <div id="chatContainer"></div>
      <div id="chatInputContainer">
        <div id="quickOptions"></div>
        <input type="text" id="chatInput" placeholder="Type your answer here..." />
        <button id="chatSendBtn">Send</button>
      </div>
    </div>
  </section>
  
  <!-- Update hidden Netlify form with method="POST" -->
  <form name="lawsuit-buddy-intake" method="POST" netlify netlify-honeypot="bot-field" hidden action="/success">
    <input type="text" name="bot-field">
    <input type="text" name="name" />
    <input type="text" name="practice_area" />
    <input type="text" name="represented" />
    <input type="text" name="incident_date" />
    <input type="text" name="incident_location" />
    <input type="text" name="is_ongoing" />
    <textarea name="case_details"></textarea>
    <input type="tel" name="phone" />
    <input type="email" name="email" />
    <input type="text" name="address" />
    <input type="text" name="birthday" />
    <input type="text" name="contact_consent" />
    <input type="text" name="state" aria-label="State" required>
    <input type="text" name="zip_code" aria-label="ZIP Code" pattern="[0-9]{5}" required>
    <input type="checkbox" name="terms_accepted" required>
    <label for="terms_accepted">I accept the terms and conditions</label>
  </form>

  <!-- ============================================================
      <p>
        <strong>Disclaimer:</strong> The information provided on this website is for general informational purposes only and does not constitute legal advice. No attorney-client relationship is formed by using this site or submitting your information. Lawsuit Buddy is a referral service and does not guarantee that any legal professional will contact you or represent you in your case. No outcome is guaranteed.
      </p>
      <p>
        By submitting your information, you consent to be contacted via phone, email, SMS, and other available means—including auto-dialers and robo-calls. You may withdraw your consent at any time.
      </p>
    </div>
  </section>
  
  <!-- ============================================================
    </div>
  </section>
  
  <!-- ============================================================
       Contact Section
  ============================================================ -->
  <section id="contact" class="section">
    <div class="container">
      <h2>Contact Us</h2>
      <p>
        For questions or further assistance, please email us at 
        <a href="mailto:info@lawsuitbuddy.com">info@lawsuitbuddy.com</a>.
      </p>
    </div>
  </section>
  
  <!-- ============================================================
       Footer Section
  ============================================================ -->
  <footer>
    <div class="container">
      <p>&copy; 2025 Lawsuit Buddy. All rights reserved.</p>
      <p>
        <a href="/terms.html">Terms of Service</a> | 
        <a href="/privacy.html">Privacy Policy</a>
      </p>
    </div>
  </footer>
  
  <!-- ============================================================
       JavaScript for Conversational Chat Interface & Smart Logic
  ============================================================ -->
  <script>
    // Define the conversation questions in a friendly, step-by-step flow.
    const questions = [
      // Basic info and case type
      { id: 'name', text: "Hi, I'm Lawsuit Buddy. What's your name?", type: 'text' },
      { id: 'practiceArea', text: "Nice to meet you, {name}! What type of legal matter are you dealing with today?", type: 'dropdown', options: ["Personal Injury", "Product Liability", "Medical Malpractice", "Employment Law", "Contract Disputes", "Other"] },
      { id: 'alreadyRepresented', text: "Are you currently represented by another attorney for this matter?", type: 'dropdown', options: ["Yes", "No"] },
      
      // Case-specific questions
      { id: 'incidentDate', text: "When did this happen? (Please provide a date or approximate date)", type: 'text' },
      { id: 'incidentLocation', text: "Where did the incident take place?", type: 'text' },
      { id: 'isOngoing', text: "Is this matter still ongoing?", type: 'dropdown', options: ["Yes", "No"] },
      { id: 'caseDetails', text: "Could you please tell me more about what happened? Feel free to add any additional details.", type: 'text' },
      
      // Contact information (gathered after case details)
      { id: 'phone', text: "Great, now may I have your phone number?", type: 'text' },
      { id: 'email', text: "What's your email address?", type: 'text' },
      { id: 'address', text: "Could you share your mailing address?", type: 'text' },
      { id: 'birthday', text: "What's your date of birth? (MM/DD/YYYY)", type: 'text' },
      
      // Consent for contact
      { id: 'contactConsent', text: "Lastly, do you agree to be contacted via phone, email, SMS, and other available means (including auto-dialers and robo-calls)?", type: 'dropdown', options: ["I AGREE", "I do not agree"] },
      
      // Final message
      { id: 'finalMessage', text: "Thank you for sharing your information, {name}! We’ll review your details and get in touch with you soon.", type: 'final' }
    ];
    
    let currentQuestionIndex = 0;
    const responses = {};
    const chatContainer = document.getElementById('chatContainer');
    const chatInput = document.getElementById('chatInput');
    const chatSendBtn = document.getElementById('chatSendBtn');
    const quickOptionsContainer = document.getElementById('quickOptions');
    
    // Function to add a chat bubble
    function addChatBubble(message, sender = 'bot') {
      const bubble = document.createElement('div');
      bubble.classList.add('chat-bubble', sender === 'bot' ? 'chat-bot' : 'chat-user');
      bubble.textContent = message;
      chatContainer.appendChild(bubble);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }
    
    // Function to render quick-answer buttons for dropdown questions
    function renderQuickOptions(options) {
      quickOptionsContainer.innerHTML = '';
      options.forEach(option => {
        const btn = document.createElement('button');
        btn.textContent = option;
        btn.classList.add('quick-option');
        btn.onclick = () => {
          addChatBubble(option, 'user');
          responses[questions[currentQuestionIndex].id] = option;
          currentQuestionIndex++;
          quickOptionsContainer.innerHTML = '';
          setTimeout(displayNextQuestion, 600);
        };
        quickOptionsContainer.appendChild(btn);
      });
    }
    
    // Function to close the chat container with a fade-out effect
    function closeChat() {
      chatContainer.style.transition = "opacity 1s ease";
      chatContainer.style.opacity = "0";
    }
    
    // Function to display the next question (with conditional logic)
    function displayNextQuestion() {
      if (currentQuestionIndex < questions.length) {
        const questionObj = questions[currentQuestionIndex];
        const indicator = showTypingIndicator();
        
        setTimeout(() => {
          indicator.remove();
          let questionText = questionObj.text;
          if (responses.name) {
            questionText = questionText.replace("{name}", responses.name);
          }
          
          addChatBubble(questionText, 'bot');
          
          if (questionObj.type === 'dropdown') {
            chatInput.style.display = 'none';
            renderQuickOptions(questionObj.options);
          } else {
            chatInput.style.display = 'block';
            chatInput.value = "";
            chatInput.placeholder = getPlaceholder(questionObj.id);
            quickOptionsContainer.innerHTML = '';
          }
          
          updateProgress();
          
          // Add edit previous link
          if (currentQuestionIndex > 0) {
            const editLink = document.createElement('div');
            editLink.className = 'edit-previous';
            editLink.textContent = 'Edit previous answer';
            editLink.onclick = () => goBackOneQuestion();
            quickOptionsContainer.appendChild(editLink);
          }
        }, 1500);
      } else {
        addChatBubble("Thank you for your responses. We are processing your details and will be in touch soon.", "bot");
        
        // Submit the responses
        submitResponses(responses).then(success => {
          if (success) {
            setTimeout(closeChat, 3000);
          } else {
            handleSubmissionError();
          }
        });
      }
    }
    
    // Enhanced validation functions
    const validators = {
      phone: (value) => {
        const phoneRegex = /^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/;
        return phoneRegex.test(value) ? null : "Please enter a valid phone number";
      },
      email: (value) => {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(value) ? null : "Please enter a valid email address";
      },
      birthday: (value) => {
        const dateRegex = /^(0[1-9]|1[0-2])\/(0[1-9]|[12][0-9]|3[01])\/\d{4}$/;
        return dateRegex.test(value) ? null : "Please enter a valid date (MM/DD/YYYY)";
      }
    };

    // Add typing indicator
    function showTypingIndicator() {
      const indicator = document.createElement('div');
      indicator.className = 'typing-indicator';
      for (let i = 0; i < 3; i++) {
        indicator.appendChild(document.createElement('div')).className = 'typing-dot';
      }
      chatContainer.appendChild(indicator);
      chatContainer.scrollTop = chatContainer.scrollHeight;
      return indicator;
    }

    // Update progress bar
    function updateProgress() {
      const progress = document.querySelector('.chat-progress');
      const percentage = (currentQuestionIndex / questions.length) * 100;
      progress.style.width = `${percentage}%`;
    }

    // Function to go back one question
    function goBackOneQuestion() {
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        responses[questions[currentQuestionIndex].id] = null;
        // Remove last two chat bubbles (question and answer)
        chatContainer.removeChild(chatContainer.lastChild);
        chatContainer.removeChild(chatContainer.lastChild);
        displayNextQuestion();
      }
    }

    // Enhanced input validation
    chatSendBtn.addEventListener('click', () => {
      const currentQuestion = questions[currentQuestionIndex];
      if (currentQuestion.type !== 'text') return;
      
      let answer = chatInput.value.trim();
      if (!answer) return;
      
      // Validate input if validator exists
      const validator = validators[currentQuestion.id];
      if (validator) {
        const error = validator(answer);
        if (error) {
          const errorDiv = document.createElement('div');
          errorDiv.className = 'chat-error';
          errorDiv.textContent = error;
          chatContainer.appendChild(errorDiv);
          return;
        }
      }
      
      addChatBubble(answer, 'user');
      responses[currentQuestion.id] = answer;
      currentQuestionIndex++;
      setTimeout(displayNextQuestion, 600);
      
      // Save responses to localStorage
      localStorage.setItem('chatResponses', JSON.stringify(responses));
    });
    
    // Initialize progress bar
    document.body.insertAdjacentHTML('afterbegin', '<div class="chat-progress"></div>');
    
    // Restore saved responses if any
    window.addEventListener('load', () => {
      const savedResponses = localStorage.getItem('chatResponses');
      if (savedResponses) {
        Object.assign(responses, JSON.parse(savedResponses));
      }
      displayNextQuestion();
    });

    // Modify the chat submission logic: Remove the explicit Content-Type header so the browser sets it correctly.
    async function submitResponses(responses) {
      try {
        const formData = new FormData();
        formData.append('form-name', 'lawsuit-buddy-intake');
        
        // Add honeypot field
        formData.append('bot-field', '');
        
        Object.keys(responses).forEach(key => {
          formData.append(key, responses[key]);
        });

        // Submit the form without manually setting headers
        const response = await fetch('/', {
          method: 'POST',
          body: new URLSearchParams(formData).toString()
        });
        
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        
        // Clear stored responses after successful submission
        localStorage.removeItem('chatResponses');
        
        return true;
      } catch (error) {
        console.error('Error:', error);
        return false;
      }
    }

    // Add error handling for failed submissions
    function handleSubmissionError() {
        addChatBubble("We're experiencing technical difficulties. Please try again later or contact us directly at info@lawsuitbuddy.com", "bot");
    }

    // Cookie consent logic
    function showCookieBanner() {
      const banner = document.getElementById('cookie-banner');
      banner.style.display = 'block';
    }

    function hideCookieBanner() {
      const banner = document.getElementById('cookie-banner');
      banner.style.display = 'none';
    }

    function setCookie(name, value, days) {
      let expires = "";
      if (days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = "; expires=" + date.toUTCString();
      }
      document.cookie = name + "=" + (value || "") + expires + "; path=/";
    }

    function getCookie(name) {
      const nameEQ = name + "=";
      const ca = document.cookie.split(';');
      for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    }

    function acceptCookies() {
      setCookie('cookieConsent', 'true', 365);
      hideCookieBanner();
    }

    if (!getCookie('cookieConsent')) {
      showCookieBanner();
    }

    // Enhanced Form Validation
    const formValidation = {
      zip_code: (value) => /^[0-9]{5}$/.test(value),
      state: (value) => /^[A-Za-z]{2}$/.test(value),
      terms_accepted: (value) => value === true
    };

    // Add error handling for form submission
    async function submitForm(data) {
      try {
        const response = await fetch('/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: new URLSearchParams(data).toString()
        });
        return response.ok;
      } catch (error) {
        console.error('Form submission error:', error);
        return false;
      }
    }

    // Initialize Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js');
    }

    function getPlaceholder(questionId) {
      switch (questionId) {
        case 'phone':
          return 'Enter your 10-digit phone number';
        case 'email':
          return 'Enter your email address';
        case 'address':
          return 'Enter your street address, city, and state';
        case 'birthday':
          return 'MM/DD/YYYY';
        default:
          return 'Type your answer here...';
      }
    }
  </script>

  <div id="cookie-banner">
    We use cookies to improve your experience. By using our site, you agree to our 
    <a href="/privacy.html">privacy policy</a>.
    <button id="cookie-accept" onclick="acceptCookies()">Accept</button>
  </div>
</body>
</html>
