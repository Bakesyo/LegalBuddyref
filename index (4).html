<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- Responsive meta tag -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Legalbuddy Referral - Legal Referral Tool</title>
  <!-- Google Fonts for a polished look -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f4f7fb;
      color: #333;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #003366;
      color: #fff;
      padding: 1rem 0;
      text-align: center;
    }
    header h1 {
      margin: 0;
      font-size: 2rem;
      letter-spacing: 1px;
    }
    .container {
      max-width: 700px;
      margin: 2rem auto;
      background: #fff;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    h2 {
      margin-top: 0;
    }
    form {
      margin-top: 1rem;
    }
    .form-step {
      display: none;
    }
    .form-step.active {
      display: block;
    }
    label {
      display: block;
      margin-top: 1rem;
      font-weight: 500;
    }
    input, select, textarea {
      width: 100%;
      padding: 0.75rem;
      margin-top: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      font-size: 1rem;
    }
    textarea {
      resize: vertical;
    }
    .navigation-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 1.5rem;
    }
    button {
      padding: 0.75rem 1.5rem;
      background-color: #003366;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #002244;
    }
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .error {
      color: #d8000c;
      background-color: #ffbaba;
      padding: 0.5rem;
      margin-top: 0.5rem;
      border-radius: 4px;
    }
    .results {
      margin-top: 2rem;
      padding: 1.5rem;
      background: #e6f2ff;
      border-radius: 8px;
      border: 1px solid #b3d1ff;
    }
    .spinner {
      display: inline-block;
      width: 24px;
      height: 24px;
      border: 3px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
      vertical-align: middle;
      margin-right: 8px;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <header>
    <h1>Legalbuddy Referral</h1>
  </header>
  <div class="container">
    <h2>Legal Referral Tool</h2>
    <form id="referralForm" novalidate>
      <!-- Error message placeholder -->
      <div id="formError" class="error" style="display:none;"></div>
      
      <!-- Step 1: Personal Details -->
      <div class="form-step active" id="step-1">
        <label for="name">Your Name:</label>
        <input type="text" id="name" name="name" placeholder="Enter your full name" required>
        
        <label for="email">Your Email:</label>
        <input type="email" id="email" name="email" placeholder="Enter your email" required>
        
        <label for="state">Select Your State:</label>
        <select id="state" name="state" required>
          <option value="">--Select a State--</option>
          <option value="NV">Nevada</option>
          <option value="CA">California</option>
          <option value="TX">Texas</option>
          <option value="NY">New York</option>
          <option value="FL">Florida</option>
        </select>
        
        <div class="navigation-buttons" style="justify-content: flex-end;">
          <button type="button" id="nextBtn">Next</button>
        </div>
      </div>
      
      <!-- Step 2: Legal Issue Details -->
      <div class="form-step" id="step-2">
        <label for="practiceArea">Select Legal Issue Area:</label>
        <select id="practiceArea" name="practiceArea" required>
          <option value="">--Select an Issue--</option>
          <option value="Family">Family Law</option>
          <option value="Criminal">Criminal Law</option>
          <option value="Business">Business Law</option>
          <option value="Personal Injury">Personal Injury</option>
          <option value="Immigration">Immigration</option>
        </select>
        
        <label for="description">Brief Description of Your Case:</label>
        <textarea id="description" name="description" placeholder="Describe your legal issue" rows="4" required></textarea>
        
        <div class="navigation-buttons">
          <button type="button" id="prevBtn">Previous</button>
          <button type="submit" id="submitBtn">Submit</button>
        </div>
      </div>
    </form>
    
    <!-- Results section -->
    <div id="results" class="results" style="display:none;">
      <h2>Application Status</h2>
      <div id="statusMessage"></div>
    </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const referralForm = document.getElementById('referralForm');
      const formError = document.getElementById('formError');
      const step1 = document.getElementById('step-1');
      const step2 = document.getElementById('step-2');
      const nextBtn = document.getElementById('nextBtn');
      const prevBtn = document.getElementById('prevBtn');
      
      // Navigation: Step 1 -> Step 2
      nextBtn.addEventListener('click', () => {
        const name = document.getElementById('name').value.trim();
        const email = document.getElementById('email').value.trim();
        const state = document.getElementById('state').value;
        if (!name || !email || !state) {
          displayError("Please fill in all required fields in Step 1.");
          return;
        }
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          displayError("Please enter a valid email address.");
          return;
        }
        clearError();
        step1.classList.remove('active');
        step2.classList.add('active');
      });
      
      // Navigation: Step 2 -> Step 1
      prevBtn.addEventListener('click', () => {
        clearError();
        step2.classList.remove('active');
        step1.classList.add('active');
      });
      
      // Form submission
      referralForm.addEventListener('submit', (event) => {
        event.preventDefault();
        clearError();
        const practiceArea = document.getElementById('practiceArea').value;
        const description = document.getElementById('description').value.trim();
        if (!practiceArea || !description) {
          displayError("Please complete all fields in Step 2.");
          return;
        }
        
        // Collect form data for submission to the backend
        const submissionData = {
          name: document.getElementById('name').value.trim(),
          email: document.getElementById('email').value.trim(),
          state: document.getElementById('state').value,
          practiceArea,
          description
        };
        console.log('Client Submission:', submissionData);
        
        const submitBtn = document.getElementById('submitBtn');
        submitBtn.disabled = true;
        submitBtn.innerHTML = `<span class="spinner" aria-hidden="true"></span> Processing...`;
        
        // Submit the data to the backend API
        fetch('http://localhost:3000/api/referrals', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(submissionData)
        })
        .then(response => response.json())
        .then(data => {
          displayStatus(data);
          submitBtn.disabled = false;
          submitBtn.textContent = 'Submit';
        })
        .catch(error => {
          console.error('Error submitting referral:', error);
          displayError('An error occurred. Please try again later.');
          submitBtn.disabled = false;
          submitBtn.textContent = 'Submit';
        });
      });
      
      function displayStatus(response) {
        const resultsDiv = document.getElementById('results');
        const statusMessage = document.getElementById('statusMessage');
        // The backend returns a generic message for every submission
        statusMessage.innerHTML = `<p>${response.message || 'Thank you for your submission. A representative will contact you soon.'}</p>`;
        resultsDiv.style.display = 'block';
      }
      
      function displayError(message) {
        formError.textContent = message;
        formError.style.display = 'block';
      }
      
      function clearError() {
        formError.textContent = "";
        formError.style.display = 'none';
      }
    });
  </script>
</body>
</html>
